# CLAUDE.md - Homelab Wiki

<project>
    <overview>
        Public documentation wiki - sanitized mirror of homelab-docs Obsidian vault.
        Built with Quartz v4, deployed to GitHub Pages via GitHub Actions.
        Automatically scrubs sensitive information before publishing.
    </overview>

    <repository>
        <name>homelab-wiki</name>
        <url>https://github.com/jhathcock-sys/homelab-wiki</url>
        <live_url>https://jhathcock-sys.github.io/homelab-wiki/</live_url>
        <visibility>public</visibility>
        <local_path>/home/cib/homelab-wiki</local_path>
    </repository>

    <architecture>
        <type>Mirror Repository</type>
        <source>homelab-docs (private Obsidian vault)</source>
        <ssg>Quartz v4</ssg>
        <ci_cd>GitHub Actions</ci_cd>
        <hosting>GitHub Pages</hosting>
        <node_version>22.22.0</node_version>
        <npm_version>10.9.4</npm_version>
    </architecture>

    <structure>
        <file path="content/">Sanitized markdown files synced from homelab-docs</file>
        <file path="sync-sanitize.sh">Main pipeline - syncs + sanitizes content</file>
        <file path="sanitize-content.sh">Regex patterns to scrub sensitive data</file>
        <file path=".publish-exclude">Files/patterns to never publish</file>
        <file path="quartz.config.ts">Site configuration (title, baseUrl, plugins)</file>
        <file path="quartz.layout.ts">Page layout (components, navigation)</file>
        <file path=".github/workflows/deploy.yml">Auto-deployment to GitHub Pages</file>
        <file path="public/">Build output (generated by Quartz, not committed)</file>
    </structure>

    <sanitization>
        <ip_addresses>
            <pattern>192\.168\.1\.[0-9]+</pattern>
            <replacement>192.168.1.XXX</replacement>
        </ip_addresses>
        <credentials>
            <pattern>password:\s*\S+</pattern>
            <replacement>password: [REDACTED]</replacement>
        </credentials>
        <mac_addresses>
            <pattern>([0-9a-fA-F]{2}:){5}[0-9a-fA-F]{2}</pattern>
            <replacement>XX:XX:XX:XX:XX:XX</replacement>
        </mac_addresses>
        <internal_domains>
            <pattern>\.local|\.home</pattern>
            <replacement>.internal</replacement>
        </internal_domains>
        <excluded_files>
            credentials.md, passwords.md, secrets.md, private*.md
            .obsidian/, .git/, drafts/, personal/, journal/
        </excluded_files>
    </sanitization>

    <workflow>
        <publish_updates>
            1. Edit files in homelab-docs vault
            2. cd ~/homelab-wiki
            3. ./sync-sanitize.sh
            4. git add -A
            5. git commit -m "Update documentation"
            6. git push
            7. GitHub Actions deploys in ~30 seconds
        </publish_updates>
        <security_check>
            grep -r '192\.168\.1\.[0-9]' content/  # Should return nothing
            grep -ri 'password:' content/ | grep -v '\[REDACTED\]'
            grep -ri 'hathcock' content/  # Check personal info
        </security_check>
        <rebuild_only>
            npx quartz build    # Local build
            npx quartz serve    # Preview at localhost:8080
        </rebuild_only>
    </workflow>

    <deployment>
        <trigger>Push to main branch or manual workflow dispatch</trigger>
        <build_time>~23 seconds</build_time>
        <deploy_time>~9 seconds</deploy_time>
        <total_time>~32 seconds</total_time>
        <build_process>
            1. Checkout repository
            2. Setup Node.js 22
            3. npm ci (install dependencies)
            4. npx quartz build
            5. Upload artifact
            6. Deploy to GitHub Pages
        </build_process>
    </deployment>

    <features>
        <component name="Search">Full-text search across all pages</component>
        <component name="Graph View">Visual connection map of WikiLinks</component>
        <component name="Backlinks">Shows pages linking to current page</component>
        <component name="Dark Mode">Theme toggle</component>
        <component name="Explorer">Folder structure navigation</component>
        <component name="Table of Contents">Auto-generated per page</component>
        <component name="WikiLinks">Native Obsidian [[link]] support</component>
        <component name="SPA Routing">Fast page transitions</component>
    </features>

    <statistics>
        <content_files>37 markdown files</content_files>
        <build_output>96 files (HTML, CSS, JS, images)</build_output>
        <redacted_items>9+ credentials/sensitive items</redacted_items>
        <sanitized_ips>All IP addresses masked</sanitized_ips>
    </statistics>

    <related_projects>
        <project>homelab-docs - Source Obsidian vault (private)</project>
        <project>my-portfolio - Links to wiki in portfolio site</project>
        <project>ai-assistant-config - Memory backup repository</project>
    </related_projects>

    <configuration>
        <site_title>Hathcock Homelab Wiki</site_title>
        <base_url>jhathcock-sys.github.io/homelab-wiki</base_url>
        <theme>Quartz default (customizable)</theme>
        <syntax_highlighting>github-light / github-dark</syntax_highlighting>
        <footer_links>
            Source Repository, Portfolio, Powered by Quartz
        </footer_links>
    </configuration>

    <troubleshooting>
        <issue name="Node.js version">
            Requires Node.js >= 22 (currently using 22.22.0 via NVM)
            If build fails: nvm use 22
        </issue>
        <issue name="Symlink deleted after sync">
            content/index.md symlink may be removed by sync
            Fix: cd content && ln -s _Index.md index.md
        </issue>
        <issue name="Sensitive data leaked">
            1. Check sanitize-content.sh patterns
            2. Add pattern to .publish-exclude
            3. Re-run ./sync-sanitize.sh
            4. Verify with security checks
        </issue>
    </troubleshooting>

    <metadata>
        <created>2026-02-04</created>
        <last_deploy>Auto-deploy on push</last_deploy>
        <backup>Synced to ai-assistant-config/homelab-wiki/</backup>
    </metadata>
</project>
